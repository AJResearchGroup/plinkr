---
title: "Detect associations with a quantitative trait"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Detect associations with a quantitative trait}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction

In this vignette,
we are going to detect associations between genetic information
and one or more quantitative traits.

## Setup

First load `plinkr`:

```{r setup}
library(plinkr)
```

This vignette will build whether or not PLINK is installed

```{r is_plink_installed}
if (is_plink_installed()) {
  message("PLINK is installed")
} else {
  message(
    "PLINK is not installed",
    "",
    "Tip: run 'plinkr::install_plink()' to do so"
  )
}
```

## Detecting associations for a single trait

To do an association (both for a single and multiple traits), 
we need some parameters:

 * The `.map` table or mapping table, which contains the location
   of the single-nucleotide polymorphisms (SNPs)
 * The `.ped` table or pedigree table, which contains the pedigree
   of the individuals and their SNP values
 * The phenotype table, which contains the one or more phenotypes
   of the individuals
 * The minor allele frequence (MAF)

Here, we get simple set of parameters, as to be used in testing,
or -in this case- a simple demonstration:
 
```{r}
assoc_qt_params <- get_test_assoc_qt_params()
```

### The mapping table

```{r}
knitr::kable(assoc_qt_params$map_table)
```

### The pedigree table

The PLINK example \code{.ped} contains, among others, the pedigree of the individuals:

```{r}
knitr::kable(assoc_qt_params$ped_table)
```

Note that the pedigree table has a column called `phenotype_value`,
which will be completely ignored.

### The phenotype table

The pedigree table has a column called `phenotype_value`,
which will be completely ignored, as it only allows to put in
one phenotype. Instead, we use a table of one or more phenotypic
values:

```{r}
knitr::kable(assoc_qt_params$phenotype_table)
```

These trait values are clearly artificial :-)

### The minor allele frequency (MAF)

The minor allele frequency (MAF) is set to 5% as a default:

```{r}
message(assoc_qt_params$maf)
```

We leave it as it is.

### Detecting the association

With the mapping, pedigree and phenotype table, 
we can detect the association between genotype and the single trait:

```{r}
if (is_plink_installed()) {
  t <- assoc_qt(
    assoc_qt_params = assoc_qt_params
  )
  knitr::kable(t)
}
```


## Detecting associations for multiple traits

NOTE: THIS DOES NOT WORK (YET?)

To detect associations for multiple traits,
all we need to do is to extent the phenotype table,
then re-run the analysis.

### The phenotype table

We simply add another column with random values:
 
```{r}
if (is_plink_installed()) {
  assoc_qt_params$phenotype_table$another_phenotype_value <-    seq_len(nrow(assoc_qt_params$phenotype_table)) * seq_len(nrow(assoc_qt_params$phenotype_table))
  knitr::kable(assoc_qt_params$phenotype_table)
}
```

### Detecting the association

With the mapping, pedigree and phenotype table, 
we can detect the association between genotype and the two traits:

```{r}
if (is_plink_installed()) {
  t <- assoc_qt(
    assoc_qt_params = assoc_qt_params
  )
  knitr::kable(t)
}
```

As can be seen, these are exactly the same values as the single-trait
association.
